--- 
wordpress_id: 52
layout: post
title: Pain with .Text and mainfeed.aspx
wordpress_url: http://blog.sideline.ca/2004/10/07/pain-with-text-and-mainfeedaspx/

<p>I had a real nightmare with <a href="http://dottextwiki.scottwater.com/default.aspx">.Text</a> trying to finish off the <a href="http://www.asp.net/Forums/ShowPost.aspx'tabindex=1&amp;amp;PostID=646447">migration from a single user setup to a multiple user setup</a>.  Actually, everything went smashingly nice according to the descriptions from <a href="http://my.aream.ca/blogs/mike/archive/2004/10/06/197.aspx">my earlier post</a>.  </p><p>However, the last thing that was messed up was because of <a href="http://dottextwiki.scottwater.com/default.aspx/Dottext.ONinetyFiveUpgrade">my earlier .94 to .95 conversion</a>.  The PostConfig column in the blog_Content table had some values of 95 in it.  That wouldn't be bad except that DNW_GetRecentPosts, the stored proc that retrieves data for mainfeed.aspx, contains this line in the select statement:</p><blockquote><p><em>...Convert(bit,case when blog_Content.PostConfig &amp;amp; 2 = 2 then 1 else 0 end) as 'IsXHTML'...</em></p></blockquote><p>along this line:</p><blockquote><p><em>...IsNull(case when PostConfig &amp;amp; 32 = 32 then blog_Content.[Description] else blog_Content.[Text] end,'') as [Description]...</em></p></blockquote><p>This wouldn't be so bad if mainfeed.aspx didn't have these lines:</p><pre><em>      if(dr["IsXHTML"] != DBNull.Value &amp;amp;&amp;amp; (bool)dr["IsXHTML"])<br />      {<br />       writer.WriteStartElement("body");<br />       writer.WriteAttributeString("xmlns","http://www.w3.org/1999/xhtml");<br />       writer.WriteRaw((string)dr["Text"]);<br />       writer.WriteEndElement();<br />      }</em> </pre><p>Basically, it means that if <em><u>IsXHTML</u></em> gets a value, then the code should output the contents of the <em><u>Text</u></em> column.  Of course, the <em><u>Text</u></em> column doesn't exist because it is being renamed to <em><u>Description</u></em> in the stored proc.  What a pain!</p><p>This only seems to be a problem with the .94 blog entries that I had.  When I ran the stored proc in Query Analyzer, I saw that the only entries that were coming back with a value of 1 for <em><u>IsXHTML</u></em> were the blog entries that I had done in .94.  Looking at the blog_Content table, I saw that these same entries had 95 as the PostConfig while the newer entries had 93.  So, I ran the following statement in Query Analyzer and it fixed my problems:</p><blockquote><p><em>update dbo.blog_Content set PostConfig = 93 where postconfig=95</em></p></blockquote><p>I also found <a href="http://asp.net/Forums/ShowPost.aspx'tabindex=1&amp;amp;PostID=566868">this post about this topic </a>where Scott Watermasysk (the creator of .Text) wonders aloud why this problem still exists!</p><p>EDIT:  I also found <a href="http://asp.net/Forums/ShowPost.aspx'tabindex=1&amp;amp;PostID=432588">this post</a> that mentions I could just add [Text] as an extra parameter to the stored proc.  That's a better solution than mine!</p>
